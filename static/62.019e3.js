webpackJsonp([62],{"W+NG":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=M(r("trpn")),p=M(r("G3dI")),o=M(r("PVZZ")),a=M(r("yF52")),i=M(r("0b0c")),n=M(r("NJOH")),l=M(r("uuhB")),d=M(r("IidI")),u=M(r("ExGt")),c=M(r("vgHw")),f=M(r("1cZb")),g=M(r("qB1w")),m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},h=function(){function e(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,r,s){return r&&e(t.prototype,r),s&&e(t,s),t}}();r("Op6J"),r("/Hhv"),r("NZBz"),r("tNTX"),r("kxBb"),r("mKHw"),r("TZP0"),r("1uA9"),r("2r77"),r("ZJow"),r("YaoS"),r("FV/t");var y=r("U7vG"),I=M(y),T=r("4n+p"),v=M(r("mtWM")),E=r("MSsH"),w=r("y3Xk");M(r("PJh5"));function M(e){return e&&e.__esModule?e:{default:e}}var b=g.default.TabPane,R=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.selectedMessages=function(e,t){r.setState({selectedRowKeys:e,selectedRows:t})},r.tabOnChange=function(e){r.props.update({name:"app",value:r.props.appList[e].appId}),r.setState({activeKey:e}),r.props.getMessageTypeList({appId:r.props.appList[e].appId,enterpriseId:r.props.enterprises[r.props.currentEnterprise].id}),r.props.getMessageList({userId:r.props.userId,appId:r.props.appList[e].appId,enterpriseId:r.props.enterprises[r.props.currentEnterprise].id,title:r.props.title,selectMessageTypes:r.props.selectMessageTypes,importance:r.props.importance,ifHide:!r.props.ifHide,orderTime:r.props.orderTime,page:0,size:10})},r.onDeleteClick=function(){r.props.update({name:"loading",value:!0}),(0,v.default)({method:"delete",url:"/api-message/send-notifications/"+r.props.userId,contentType:"application/json",withCredentials:!0,data:r.state.selectedRows.map(function(e){return{messageId:e.id,version:e.version}})}).then(function(e){200===e.status?(r.setState({selectedRowKeys:[],selectedRows:[]}),f.default.success("删除成功"),r.props.getMessageList({userId:r.props.userId,appId:r.props.app,enterpriseId:r.props.enterprises[r.props.currentEnterprise].id,title:r.props.title,selectMessageTypes:r.props.selectMessageTypes,importance:r.props.importance,ifHide:!r.props.ifHide,orderTime:r.props.orderTime,page:r.props.page,size:r.props.size})):(r.props.update({name:"loading",value:!1}),f.default.error(e.data))}).catch(function(e){f.default.error("连接错误"),r.props.update({name:"loading",value:!1})})},r.handleTableChange=function(e,t,s){r.props.orderTime!==s.order&&(r.props.update({name:"orderTime",value:s.order}),r.props.getMessageList({userId:r.props.userId,appId:r.props.app,enterpriseId:r.props.enterprises[r.props.currentEnterprise].id,title:r.props.title,selectMessageTypes:r.props.selectMessageTypes,importance:r.props.importance,ifHide:!r.props.ifHide,orderTime:s.order,page:r.props.page,size:r.props.size}))},r.onRevertClick=function(){r.props.update({name:"loading",value:!0}),(0,v.default)({method:"delete",url:"/api-message/revert-notifications/"+r.props.userId,contentType:"application/json",withCredentials:!0,data:{messageId:r.state.selectedRows[0].id,version:r.state.selectedRows[0].version}}).then(function(e){200===e.status?(r.setState({selectedRowKeys:[],selectedRows:[]}),f.default.success("删除成功"),r.props.getMessageList({userId:r.props.userId,appId:r.props.app,enterpriseId:r.props.enterprises[r.props.currentEnterprise].id,title:r.props.title,selectMessageTypes:r.props.selectMessageTypes,importance:r.props.importance,ifHide:!r.props.ifHide,orderTime:r.props.orderTime,page:r.props.page,size:r.props.size})):(r.props.update({name:"loading",value:!1}),f.default.error(e.data))}).catch(function(e){f.default.error("连接错误"),r.props.update({name:"loading",value:!1})})},r.state={activeKey:"0",selectedRowKeys:[],selectedRows:[]},r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,y.Component),h(t,[{key:"componentDidMount",value:function(){this.props.enterprises[this.props.currentEnterprise]&&this.props.roles[this.props.currentRole]&&this.props.getAppList(this.props.enterprises[this.props.currentEnterprise].id,this.props.roles[this.props.currentRole].id,this.props.userId)}},{key:"componentDidUpdate",value:function(e){(this.props.enterprises[this.props.currentEnterprise]&&(this.props.currentEnterprise!==e.currentEnterprise||this.props.enterprises!==e.enterprises)||this.props.roles[this.props.currentRole]&&(this.props.currentRole!==e.currentRole||this.props.roles!==e.roles))&&this.props.getAppList(this.props.enterprises[this.props.currentEnterprise].id,this.props.roles[this.props.currentRole].id,this.props.userId)}},{key:"render",value:function(){var e=this,t={total:this.props.total,pageSize:this.props.size,current:this.props.page+1,showSizeChanger:!0,pageSizeOptions:["10","15","20"],showQuickJumper:!0,onShowSizeChange:function(t,r){e.props.getMessageList({userId:e.props.userId,appId:e.props.app,enterpriseId:e.props.enterprises[e.props.currentEnterprise].id,title:e.props.title,selectMessageTypes:e.props.selectMessageTypes,importance:e.props.importance,ifHide:!e.props.ifHide,orderTime:e.props.orderTime,page:0,size:r})},onChange:function(t){e.props.getMessageList({userId:e.props.userId,appId:e.props.app,enterpriseId:e.props.enterprises[e.props.currentEnterprise].id,title:e.props.title,selectMessageTypes:e.props.selectMessageTypes,importance:e.props.importance,ifHide:!e.props.ifHide,orderTime:e.props.orderTime,page:t-1,size:e.props.size})}},r=[{title:"消息",dataIndex:"message",render:function(t,r,s){var p={fontWeight:900,color:"black",fontSize:".875rem"};return I.default.createElement("div",{style:{display:"flex",alignItems:"center"}},I.default.createElement("div",{style:{overflow:"hidden",maxWidth:"300px"},onClick:function(t){e.props.onToDetail("/console/message-detail-page/"+r.id+"/send")}},I.default.createElement("span",{style:p},r.subject),I.default.createElement("span",{style:{paddingLeft:4,paddingRight:4}},"-"),I.default.createElement("span",{style:p},r.content)),"importance"===r.importance?I.default.createElement(u.default,{title:"重要邮件",arrowPointAtCenter:!0},I.default.createElement(c.default,{type:"flag",style:{color:"#f5222d",fontWeight:400,marginLeft:4}})):null)}},{title:"类别",dataIndex:"messageType.name",render:function(e,t,r){return I.default.createElement("span",null,e)}},{title:"时间",dataIndex:"createdTime",render:function(e){return(0,w.toLocaleString)(e)},defaultSortOrder:"descend",sorter:!0}],f=this.state,m=f.selectedRowKeys,h=f.selectedRows;return I.default.createElement(s.default,{spinning:this.props.loading,size:"large"},I.default.createElement("h2",null,"消息中心"),I.default.createElement("hr",null),I.default.createElement(d.default,{onClick:function(){e.props.onToDetail("/console/message-create")},disabled:0===this.props.appList.length},"新消息"),I.default.createElement(g.default,{defaultActiveKey:"0",activeKey:this.state.activeKey,onChange:this.tabOnChange,tabPosition:"top"},this.props.appList.map(function(s,u){return I.default.createElement(b,{tab:s.appName,key:u+""},I.default.createElement(i.default,{style:{marginBottom:8}},I.default.createElement(l.default,{value:e.props.title,style:{width:150,marginRight:8},placeholder:"请输入标题",onChange:function(t){e.props.update({name:"title",value:t.target.value}),e.props.getMessageList({userId:e.props.userId,appId:e.props.app,enterpriseId:e.props.enterprises[e.props.currentEnterprise].id,title:t.target.value,selectMessageTypes:e.props.selectMessageTypes,importance:e.props.importance,ifHide:!e.props.ifHide,orderTime:e.props.orderTime,page:e.props.page,size:e.props.size})}}),I.default.createElement(n.default,{mode:"multiple",value:e.props.selectMessageTypes,style:{width:150,marginRight:8},placeholder:"请选择类型",onChange:function(t){e.props.update({name:"selectMessageTypes",value:t}),e.props.getMessageList({userId:e.props.userId,appId:e.props.app,enterpriseId:e.props.enterprises[e.props.currentEnterprise].id,title:e.props.title,selectMessageTypes:t,importance:e.props.importance,ifHide:!e.props.ifHide,orderTime:e.props.orderTime,page:e.props.page,size:e.props.size})}},e.props.messageTypeList.map(function(e){return I.default.createElement(n.default.Option,{key:e.id,value:e.id},e.name)})),I.default.createElement(n.default,{value:e.props.importance,style:{width:150},placeholder:"请选择是否重要",onChange:function(t){e.props.update({name:"importance",value:t}),e.props.getMessageList({userId:e.props.userId,appId:e.props.app,enterpriseId:e.props.enterprises[e.props.currentEnterprise].id,title:e.props.title,selectMessageTypes:e.props.selectMessageTypes,importance:t,ifHide:!e.props.ifHide,orderTime:e.props.orderTime,page:e.props.page,size:e.props.size})}},I.default.createElement(n.default.Option,{key:"0",value:"importance,normal"},"全部"),I.default.createElement(n.default.Option,{key:"1",value:"importance"},"重要"),I.default.createElement(n.default.Option,{key:"2",value:"normal"},"不重要"))),I.default.createElement(i.default,null,I.default.createElement(a.default,{rowSelection:{selectedRowKeys:m,selectedRows:h,type:"checkbox",onChange:e.selectedMessages},rowKey:function(e){return e.id},columns:r,dataSource:e.props.messageList,showHeader:!0,pagination:t,onChange:e.handleTableChange})),I.default.createElement(i.default,null,I.default.createElement(p.default,{style:{marginBottom:8}},I.default.createElement(o.default,{checked:e.props.ifHide,onChange:function(t){e.props.update({name:"ifHide",value:t.target.checked}),e.props.getMessageList({userId:e.props.userId,appId:e.props.app,enterpriseId:e.props.enterprises[e.props.currentEnterprise].id,title:e.props.title,selectMessageTypes:e.props.selectMessageTypes,importance:e.props.importance,ifHide:!t.target.checked,orderTime:e.props.orderTime,page:e.props.page,size:e.props.size})}},"隐藏")),I.default.createElement(p.default,null,I.default.createElement(d.default,{style:{marginRight:4},type:"danger",icon:"delete",disabled:0===e.state.selectedRowKeys.length,onClick:e.onDeleteClick},"隐藏"),I.default.createElement(d.default,{style:{marginRight:4},type:"danger",icon:"delete",disabled:1!==e.state.selectedRowKeys.length,onClick:e.onRevertClick},"撤回"))))})))}}]),t}();t.default=(0,T.connect)(function(e){return m({},e.messageSent,{enterprises:e.userData.enterprises,currentEnterprise:e.userData.currentEnterprise,userId:e.authentication.userId,roles:e.userData.roles,currentRole:e.userData.currentRole})},function(e,t){return{dispatch:e,update:function(t){e((0,E.update)(t))},getAppList:function(t,r,s){e((0,E.getAppList)(t,r,s))},getMessageTypeList:function(t){e((0,E.getMessageTypeList)(t))},getMessageList:function(t){e((0,E.getMessageList)(t))},onToDetail:function(e){t.history.push(e)}}})(R)}});