webpackJsonp([58],{"E+aa":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},n=function(){function e(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(t,a,l){return a&&e(t.prototype,a),l&&e(t,l),t}}(),r=d(a("U7vG")),o=(a("Pq8k"),a("4n+p")),i=d(a("pbCd")),s=a("08pr"),u=a("Zfgq");function d(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.default.Component),n(t,[{key:"render",value:function(){if(""!==this.props.selectedAlgorithm)return r.default.createElement("div",{style:{width:"80%",margin:"0 auto",marginTop:"32px"}},r.default.createElement(i.default,this.props));u.browserHistory.push("/exception/404")}}]),t}();t.default=(0,o.connect)(function(e){return l({},e.verifyAlgorithm,{currentLoginUser:e.authentication.userId})},function(e){return{dispatch:e,update:function(t){e((0,s.updateData)(t))},uploadFile:function(t){e((0,s.uploadFile)(t))}}})(p)},pbCd:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=m(a("rpsp")),n=m(a("vgHw")),r=m(a("trpn")),o=m(a("uuhB")),i=m(a("yF52")),s=m(a("IidI")),u=m(a("vaID")),d=function(){function e(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(t,a,l){return a&&e(t.prototype,a),l&&e(t,l),t}}();a("Nmhe"),a("ZJow"),a("Op6J"),a("TZP0"),a("tNTX"),a("1uA9"),a("nclB");var p=m(a("U7vG")),c=a("Pq8k"),f=a("Zfgq"),h=m(a("mtWM"));function m(e){return e&&e.__esModule?e:{default:e}}var y=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.handlePassOK=a.handlePassOK.bind(a),a.handleNotPassOK=a.handleNotPassOK.bind(a),a.handleCancel=a.handleCancel.bind(a),a.showPassModal=a.showPassModal.bind(a),a.showNotPassModal=a.showNotPassModal.bind(a),a.handleChangeFile=a.handleChangeFile.bind(a),a.runData=a.runData.bind(a),a.state={loading:!1,passModalVisible:!1,notPassModalVisible:!1,runModalVisible:!1,notPassReason:""},a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,p.default.Component),d(t,[{key:"showPassModal",value:function(){this.setState({passModalVisible:!0})}},{key:"showNotPassModal",value:function(){this.setState({notPassModalVisible:!0})}},{key:"handleCancel",value:function(){this.setState({passModalVisible:!1,notPassModalVisible:!1,runModalVisible:!1})}},{key:"handlePassOK",value:function(){var e=this;this.setState({loading:!0}),(0,h.default)({method:"post",url:"/api-algorithm/createAlgorithmAuthRecord",contentType:"application/json",withCredentials:!0,data:{auditorName:this.props.currentLoginUser,algorithmId:this.props.selectedAlgorithm.id,status:3,remark:""}}).then(function(t){(0,h.default)({method:"post",url:"/api-user/notificationObjects",contentType:"application/json",withCredentials:!0,data:{actorId:e.props.currentLoginUser,notifierIds:e.props.selectedAlgorithm.createByName,title:"审核通知",description:"恭喜您，您的算法"+e.props.selectedAlgorithm.name+"通过审核！",type:"审核消息",selfType:"01",action:"审核通过"}}).then(function(e){f.browserHistory.push("/console/verify-algorithm-list")},function(e){})},function(e){}),setTimeout(function(){e.setState({loading:!1,passModalVisible:!1})},3e3)}},{key:"handleNotPassOK",value:function(){var e=this;this.setState({loading:!0}),(0,h.default)({method:"post",url:"/api-algorithm/createAlgorithmAuthRecord",contentType:"application/json",withCredentials:!0,data:{auditorName:this.props.currentLoginUser,algorithmId:this.props.selectedAlgorithm.id,status:4,remark:this.state.notPassReason}}).then(function(t){(0,h.default)({method:"post",url:"/api-user/notificationObjects",contentType:"application/json",withCredentials:!0,data:{actorId:e.props.currentLoginUser,notifierIds:e.props.selectedAlgorithm.createById,title:"审核通知",description:"抱歉，您的算法："+e.props.selectedAlgorithm.name+"未通过审核！原因是："+e.state.notPassReason,type:"审核消息",selfType:"01",action:"审核不通过"}}).then(function(t){e.setState({notPassReason:""}),f.browserHistory.push("/console/verify-algorithm-list")},function(e){})},function(e){}),setTimeout(function(){e.setState({loading:!1,notPassModalVisible:!1})},3e3)}},{key:"handleChangeFile",value:function(e){"done"===e.file.status&&this.props.update({name:"inputUrl",value:e.fileList[0].response})}},{key:"runData",value:function(){var e=this;this.setState({runModalVisible:!0}),(new Headers).append("Content-Type","application/json");var t={name:"count.py"};t.model=this.props.model,t.input={type:this.props.inputType,path:"andon.data"},t.output={type:this.props.outputType,path:this.props.outputUrl},t.resourse={"num-executors":this.props.num,"executor-memory":this.props.memory,"executor-cores":this.props.cores};var a={};return this.props.selectedAlgorithm.parameters.forEach(function(e){a[e.name]=e.defaultValue}),t.algorithm={},(0,h.default)({method:"post",url:"/api-data/execute",contentType:"application/json",withCredentials:!0,data:t}).then(function(t){var a={};return a.type=e.props.outputType,a.path=e.props.outputUrl,a.limit=10,(0,h.default)({method:"post",url:"/api-data/data",contentType:"application/json",withCredentials:!0,data:a}).then(function(t){return e.setState({runModalVisible:!1}),u.default.success({title:"运行成功"}),t.json()},function(e){u.default.error({title:"运行失败"})}).then(function(t){var a=[],l=0;for(var n in t[0])a[l]=n,l++;e.props.update({name:"resultTitle",value:a}),e.props.update({name:"resultData",value:t})}).catch(function(t){e.setState({runModalVisible:!1}),u.default.error({title:"获取数据时出现错误"})})},function(t){e.setState({runModalVisible:!1}),u.default.error({title:"运行失败"})}).catch(function(t){e.setState({runModalVisible:!1}),u.default.error({title:"运行中出现错误"})})}},{key:"render",value:function(){var e=this;return p.default.createElement("div",null,p.default.createElement("div",null,p.default.createElement(s.default,{type:"primary",style:{marginRight:8},onClick:function(){return f.browserHistory.push("/console/verify-algorithm-list")}},"返回"),p.default.createElement(s.default,{type:"primary",style:{marginRight:8},onClick:this.showPassModal,disabled:"3"===this.props.selectedAlgorithm.algorithmStatus.code||"4"===this.props.selectedAlgorithm.algorithmStatus.code},"审核通过"),p.default.createElement(s.default,{type:"primary",style:{marginRight:8},onClick:this.showNotPassModal,disabled:"3"===this.props.selectedAlgorithm.algorithmStatus.code||"4"===this.props.selectedAlgorithm.algorithmStatus.code},"审核失败"),p.default.createElement("a",{href:"/api-algorithmfiles/?name="+this.props.selectedAlgorithm.algorithmFileId,download:"算法源文件",style:{marginLeft:"5px"}},p.default.createElement(s.default,{type:"primary",style:{marginRight:8},disabled:null===this.props.selectedAlgorithm.algorithmFileId||""===this.props.selectedAlgorithm.algorithmFileId},"下载源文件"))),p.default.createElement("div",{style:{backgroundColor:"#F8F8F8",padding:24,margin:"10px 0"}},p.default.createElement("div",{style:{display:"flex",marginBottom:20}},p.default.createElement("div",null,p.default.createElement("strong",null,"算法名称"),":",this.props.selectedAlgorithm.name),p.default.createElement("div",{style:{marginLeft:100}},p.default.createElement("strong",null,"算法类别"),":",this.props.selectedAlgorithm.algorithmCategory.name)),p.default.createElement("div",null,p.default.createElement("strong",null,"算法描述")),this.props.selectedAlgorithm.description),p.default.createElement("div",null,p.default.createElement(i.default,{columns:[{title:"参数名",dataIndex:"name"},{title:"参数类型",dataIndex:"type"},{title:"默认值",dataIndex:"defaultValue"},{title:"最小值",dataIndex:"minValue"},{title:"最大值",dataIndex:"maxValue"}],dataSource:this.props.selectedAlgorithm.parameters,bordered:!0}),p.default.createElement(u.default,{visible:this.state.passModalVisible,title:"审核通过",footer:[p.default.createElement(s.default,{key:"back",size:"large",onClick:this.handleCancel},"取消"),p.default.createElement(s.default,{key:"submit",type:"primary",size:"large",loading:this.state.loading,onClick:this.handlePassOK},"确认")]},p.default.createElement("p",null,"是否通过",this.props.selectedAlgorithm.name,"的审核？")),p.default.createElement(u.default,{visible:this.state.notPassModalVisible,title:"审核不通过",footer:[p.default.createElement(s.default,{key:"back",size:"large",onClick:this.handleCancel},"取消"),p.default.createElement(s.default,{key:"submit",type:"primary",size:"large",loading:this.state.loading,onClick:this.handleNotPassOK,disabled:""===this.state.notPassReason},"确认")]},p.default.createElement("scan",null,"审核未通过的原因"),p.default.createElement(o.default,{type:"textarea",rows:3,placeholder:"例如算法信息、效果...",onChange:function(t){e.setState({notPassReason:t.target.value})}}),p.default.createElement("p",null,"是否不通过",this.props.selectedAlgorithm.name,"的审核？")),p.default.createElement(u.default,{visible:this.state.runModalVisible,footer:null,onCancel:this.handleCancel},p.default.createElement("div",{style:{margin:"0 auto"}},p.default.createElement("p",null,"正在运行中"),p.default.createElement("div",null,p.default.createElement(r.default,null))))),p.default.createElement("div",{style:{display:"flex",marginTop:8}},p.default.createElement("div",null,p.default.createElement(l.default,{action:"/api-datasetfiles/",data:function(e){return{File:e}},onChange:this.handleChangeFile},p.default.createElement(s.default,{type:"primary",style:{width:120},disabled:""!==this.props.inputUrl},p.default.createElement(n.default,{type:"upload"})," 上传"))),p.default.createElement("div",{style:{marginLeft:8}},p.default.createElement(s.default,{id:"RunButton",type:"primary",onClick:this.runData},"运行"))),this.props.resultTitle.length>0&&p.default.createElement("div",null,p.default.createElement("label",null,"处理结果集"),p.default.createElement(i.default,{bordered:!0,striped:!0,hover:!0,radius:!0},p.default.createElement("thead",null,p.default.createElement("tr",null,this.props.resultTitle.map(function(e){return p.default.createElement("th",null,e)}))),p.default.createElement("tbody",null,this.props.resultData.map(function(t,a){return p.default.createElement("tr",{key:a},e.props.resultTitle.map(function(e){return p.default.createElement("td",null,t[e])}))})))))}}]),t}();t.default=(0,c.injectIntl)(y)}});