webpackJsonp([40],{F7Sr:function(e,t,s){(t=e.exports=s("FZ+f")(!0)).push([e.i,".src-scenes-Message-style_logo--2bwDlRRX{height:48px;background:hsla(0,0%,100%,.2);margin:16px}.src-scenes-Message-style_trigger--2pA754Cb{font-size:18px;line-height:64px;padding:0 24px;cursor:pointer;transition:color .3s}.src-scenes-Message-style_trigger--2pA754Cb:hover{color:#1890ff}.src-scenes-Message-style_rowCursor--JB-BcXuD{cursor:pointer}.src-scenes-Message-style_rowCursor--JB-BcXuD:hover{box-shadow:1px 1px 10px rgba(0,0,0,.1)}.src-scenes-Message-style_messageSelection--RD6Yr4Yo{border-bottom:1px solid transparent}.src-scenes-Message-style_messageSelection--RD6Yr4Yo:hover{border-bottom:1px solid rgba(0,0,0,.7)}.src-scenes-Message-style_detailContainer--3NV0agDv{width:100%;margin:0 auto;padding:16px;display:flex;flex-direction:column}.src-scenes-Message-style_detailSubject--3qDXwIFO{display:flex;align-items:center;margin-bottom:8px}.src-scenes-Message-style_detailFromToInfo--3ntR9Sye{display:flex;justify-content:space-between;padding:4px}.src-scenes-Message-style_detailsFromTo--1rh1oPd5{display:flex;flex-direction:column}.src-scenes-Message-style_detailsInfoSmall--3-E90FZN{color:#5f6368;font-size:.75rem;margin-left:8px}.src-scenes-Message-style_detailContent--1GRUlTtG{padding:4px}","",{version:3,sources:["D:/siacloud2/sia-cloud-foundation-v2/frontend/src/scenes/Message/D:/siacloud2/sia-cloud-foundation-v2/frontend/src/scenes/Message/style.less","D:/siacloud2/sia-cloud-foundation-v2/frontend/src/scenes/Message/style.less"],names:[],mappings:"AAAA,yCACE,YAAA,AACA,8BAAA,AACA,WAAA,CCCD,ADED,4CACE,eAAA,AACA,iBAAA,AACA,eAAA,AACA,eAAA,AACA,oBAAA,CCAD,ADGD,kDACE,aAAA,CCDD,ADID,8CACE,cAAA,CCFD,ADKD,oDACE,sCAAA,CCHD,ADMD,qDACE,mCAAA,CCJD,ADOD,2DACE,sCAAA,CCLD,ADQD,oDACE,WAAA,AACA,cAAA,AACA,aAAA,AACA,aAAA,AACA,qBAAA,CCND,ADSD,kDACE,aAAA,AACA,mBAAA,AACA,iBAAA,CCPD,ADUD,qDACE,aAAA,AACA,8BAAA,AACA,WAAA,CCRD,ADWD,kDACE,aAAA,AACA,qBAAA,CCTD,ADYD,qDACE,cAAA,AACA,iBAAA,AACA,eAAA,CCVD,ADaD,kDACE,WAAA,CCXD",file:"style.less",sourcesContent:[".logo {\n  height: 48px;\n  background: rgba(255, 255, 255, .2);\n  margin: 16px;\n}\n\n.trigger {\n  font-size: 18px;\n  line-height: 64px;\n  padding: 0 24px;\n  cursor: pointer;\n  transition: color .3s;\n}\n\n.trigger:hover {\n  color: #1890ff;\n}\n\n.rowCursor {\n  cursor: pointer;\n}\n\n.rowCursor:hover {\n  box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.1);\n}\n\n.messageSelection {\n  border-bottom: 1px solid transparent;\n}\n\n.messageSelection:hover {\n  border-bottom: 1px solid rgba(0, 0, 0, .7);\n}\n\n.detailContainer {\n  width: 100%;\n  margin: 0 auto;\n  padding: 16px;\n  display: flex;\n  flex-direction: column;\n}\n\n.detailSubject {\n  display: flex;\n  align-items: center;\n  margin-bottom: 8px;\n}\n\n.detailFromToInfo {\n  display: flex;\n  justify-content: space-between;\n  padding: 4px;\n}\n\n.detailsFromTo {\n  display: flex;\n  flex-direction: column;\n}\n\n.detailsInfoSmall {\n  color: #5f6368;\n  font-size: 0.75rem;\n  margin-left: 8px\n}\n\n.detailContent {\n  padding: 4px\n}\n\n",".logo {\n  height: 48px;\n  background: rgba(255, 255, 255, 0.2);\n  margin: 16px;\n}\n.trigger {\n  font-size: 18px;\n  line-height: 64px;\n  padding: 0 24px;\n  cursor: pointer;\n  transition: color .3s;\n}\n.trigger:hover {\n  color: #1890ff;\n}\n.rowCursor {\n  cursor: pointer;\n}\n.rowCursor:hover {\n  box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.1);\n}\n.messageSelection {\n  border-bottom: 1px solid transparent;\n}\n.messageSelection:hover {\n  border-bottom: 1px solid rgba(0, 0, 0, 0.7);\n}\n.detailContainer {\n  width: 100%;\n  margin: 0 auto;\n  padding: 16px;\n  display: flex;\n  flex-direction: column;\n}\n.detailSubject {\n  display: flex;\n  align-items: center;\n  margin-bottom: 8px;\n}\n.detailFromToInfo {\n  display: flex;\n  justify-content: space-between;\n  padding: 4px;\n}\n.detailsFromTo {\n  display: flex;\n  flex-direction: column;\n}\n.detailsInfoSmall {\n  color: #5f6368;\n  font-size: 0.75rem;\n  margin-left: 8px;\n}\n.detailContent {\n  padding: 4px;\n}\n"],sourceRoot:""}]),t.locals={logo:"src-scenes-Message-style_logo--2bwDlRRX",trigger:"src-scenes-Message-style_trigger--2pA754Cb",rowCursor:"src-scenes-Message-style_rowCursor--JB-BcXuD",messageSelection:"src-scenes-Message-style_messageSelection--RD6Yr4Yo",detailContainer:"src-scenes-Message-style_detailContainer--3NV0agDv",detailSubject:"src-scenes-Message-style_detailSubject--3qDXwIFO",detailFromToInfo:"src-scenes-Message-style_detailFromToInfo--3ntR9Sye",detailsFromTo:"src-scenes-Message-style_detailsFromTo--1rh1oPd5",detailsInfoSmall:"src-scenes-Message-style_detailsInfoSmall--3-E90FZN",detailContent:"src-scenes-Message-style_detailContent--1GRUlTtG"}},Ipnr:function(e,t,s){var r=s("F7Sr");"string"==typeof r&&(r=[[e.i,r,""]]);s("fjbf")(r,{});r.locals&&(e.exports=r.locals)},V6ZP:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=b(s("trpn")),n=b(s("IidI")),p=b(s("G3dI")),a=b(s("PVZZ")),o=b(s("yF52")),i=b(s("0b0c")),l=b(s("NJOH")),d=b(s("uuhB")),c=b(s("ExGt")),u=b(s("vgHw")),f=b(s("1cZb")),g=b(s("qB1w")),m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},A=function(){function e(e,t){for(var s=0;s<t.length;s++){var r=t[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,s,r){return s&&e(t.prototype,s),r&&e(t,r),t}}();s("Op6J"),s("1uA9"),s("/Hhv"),s("NZBz"),s("tNTX"),s("kxBb"),s("mKHw"),s("TZP0"),s("2r77"),s("ZJow"),s("YaoS"),s("FV/t");var h=s("U7vG"),y=b(h),C=s("4n+p"),v=b(s("mtWM")),I=s("T/BY"),x=s("y3Xk"),T=b(s("Ipnr"));b(s("PJh5"));function b(e){return e&&e.__esModule?e:{default:e}}var E=g.default.TabPane,D=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return s.selectedMessages=function(e,t){s.setState({selectedRowKeys:e,selectedRows:t})},s.tabOnChange=function(e){s.props.update({name:"app",value:s.props.appList[e].appId}),s.props.update({name:"title",value:""}),s.props.update({name:"selectMessageTypes",value:[]}),s.props.update({name:"ifRead",value:"true,false"}),s.props.update({name:"importance",value:"importance,normal"}),s.props.update({name:"orderTime",value:"descend"}),s.setState({activeKey:e}),"0"===e?s.props.update({name:"messageTypeList",value:[]}):s.props.getMessageTypeList({appId:s.props.appList[e].appId,enterpriseId:s.props.enterprises[s.props.currentEnterprise].id}),s.props.getMessageList({userId:s.props.userId,appId:s.props.appList[e].appId,enterpriseId:s.props.enterprises[s.props.currentEnterprise].id,title:s.props.title,selectMessageTypes:s.props.selectMessageTypes,ifRead:s.props.ifRead,importance:s.props.importance,ifHide:!s.props.ifHide,orderTime:s.props.orderTime,page:0,size:10})},s.onDeleteClick=function(){s.props.update({name:"loading",value:!0}),(0,v.default)({method:"delete",url:"/api-message/notifications/"+s.props.userId,contentType:"application/json",withCredentials:!0,data:s.state.selectedRows.map(function(e){return{messageId:e.id,version:e.version}})}).then(function(e){200===e.status?(s.setState({selectedRowKeys:[],selectedRows:[]}),f.default.success("隐藏成功"),s.props.getMessageList({userId:s.props.userId,appId:s.props.app,enterpriseId:s.props.enterprises[s.props.currentEnterprise].id,title:s.props.title,selectMessageTypes:s.props.selectMessageTypes,ifRead:s.props.ifRead,importance:s.props.importance,ifHide:!s.props.ifHide,orderTime:s.props.orderTime,page:s.props.page,size:s.props.size})):(s.props.update({name:"loading",value:!1}),f.default.error(e.data))}).catch(function(e){f.default.error("连接错误"),s.props.update({name:"loading",value:!1})})},s.onMarkReadClick=function(){s.props.update({name:"loading",value:!0}),(0,v.default)({method:"patch",url:"/api-message/notifications/"+s.props.userId,contentType:"application/json",withCredentials:!0,data:s.state.selectedRows.map(function(e){return{messageId:e.id,version:e.version}})}).then(function(e){200===e.status?(f.default.success("已读成功"),s.setState({selectedRowKeys:[],selectedRows:[]}),s.props.getMessageList({userId:s.props.userId,appId:s.props.app,enterpriseId:s.props.enterprises[s.props.currentEnterprise].id,title:s.props.title,selectMessageTypes:s.props.selectMessageTypes,ifRead:s.props.ifRead,importance:s.props.importance,ifHide:!s.props.ifHide,orderTime:s.props.orderTime,page:s.props.page,size:s.props.size})):(s.props.update({name:"loading",value:!1}),f.default.error(e.data))}).catch(function(e){f.default.info("已被标记已读"),s.props.update({name:"loading",value:!1})})},s.onDeleteClickDetail=function(e){var t=e.data;(0,v.default)({method:"delete",url:"/api-message/notifications/"+t.userId,contentType:"application/json",withCredentials:!0,data:[{messageId:t.messageId,version:t.version}]}).then(function(e){f.default.error("隐藏成功"),s.props.onReturn()}).catch(function(e){f.default.error("隐藏失败"),s.props.onReturn()})},s.handleTableChange=function(e,t,r){s.props.orderTime!==r.order&&(s.props.update({name:"orderTime",value:r.order}),s.props.getMessageList({userId:s.props.userId,appId:s.props.app,enterpriseId:s.props.enterprises[s.props.currentEnterprise].id,title:s.props.title,selectMessageTypes:s.props.selectMessageTypes,ifRead:s.props.ifRead,importance:s.props.importance,ifHide:!s.props.ifHide,orderTime:r.order,page:0,size:10}))},s.state={activeKey:"0",selectedRowKeys:[],selectedRows:[]},s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,h.Component),A(t,[{key:"componentDidMount",value:function(){(this.props.enterprises[this.props.currentEnterprise]||this.props.roles[this.props.currentRole])&&this.props.getAppList(this.props.enterprises[this.props.currentEnterprise].id,this.props.roles[this.props.currentRole].id,this.props.userId)}},{key:"componentDidUpdate",value:function(e){(this.props.enterprises[this.props.currentEnterprise]&&(this.props.currentEnterprise!==e.currentEnterprise||this.props.enterprises!==e.enterprises)||this.props.roles[this.props.currentRole]&&(this.props.currentRole!==e.currentRole||this.props.roles!==e.roles))&&this.props.getAppList(this.props.enterprises[this.props.currentEnterprise].id,this.props.roles[this.props.currentRole].id,this.props.userId)}},{key:"render",value:function(){var e=this,t={total:this.props.total,pageSize:this.props.size,current:this.props.page+1,showSizeChanger:!0,pageSizeOptions:["10","15","20"],showQuickJumper:!0,onShowSizeChange:function(t,s){e.props.getMessageList({userId:e.props.userId,appId:e.props.app,enterpriseId:e.props.enterprises[e.props.currentEnterprise].id,title:e.props.title,selectMessageTypes:e.props.selectMessageTypes,ifRead:e.props.ifRead,importance:e.props.importance,ifHide:!e.props.ifHide,orderTime:e.props.orderTime,page:0,size:s})},onChange:function(t){e.props.getMessageList({userId:e.props.userId,appId:e.props.app,enterpriseId:e.props.enterprises[e.props.currentEnterprise].id,title:e.props.title,selectMessageTypes:e.props.selectMessageTypes,ifRead:e.props.ifRead,importance:e.props.importance,ifHide:!e.props.ifHide,orderTime:e.props.orderTime,page:t-1,size:e.props.size})}},s=[{dataIndex:"hasRead",render:function(e,t,s){return e?null:y.default.createElement("div",{style:{color:"#428bca",fontSize:10}},"●")},width:"2%"},{title:"消息",dataIndex:"message",render:function(t,s,r){var n={fontWeight:900,color:"black",fontSize:".875rem"};return s.hasRead&&(n={fontWeight:400,color:"#999",fontSize:".875rem"}),y.default.createElement("div",{style:{display:"flex",alignItems:"center"}},y.default.createElement("div",{style:{textOverflow:"ellipsis",overflow:"hidden",maxWidth:"400px",whiteSpace:"nowrap"},className:T.default.messageSelection,onClick:function(r){e.props.onToDetail("/console/message-detail-page/"+t.id+"/receive"),t.hasDeleted||t.hasRead||(0,v.default)({method:"patch",url:"/api-message/notifications/"+e.props.userId,contentType:"application/json",withCredentials:!0,data:[{messageId:s.id,version:s.version}]})}},y.default.createElement("span",{style:n},s.message.subject),y.default.createElement("span",{style:{paddingLeft:4,paddingRight:4}},"-"),y.default.createElement("span",{style:n},s.message.content)),"importance"===s.message.importance?y.default.createElement(c.default,{title:"重要邮件",arrowPointAtCenter:!0},y.default.createElement(u.default,{type:"flag",style:{color:"#f5222d",fontWeight:400,marginLeft:4}})):null)}},{title:"应用",dataIndex:"message.appId",render:function(t,s,r){var n=e.props.appList.find(function(e){return e.appId===t});return null!=n?y.default.createElement("span",null,n.appName):y.default.createElement("span",null)}},{title:"发布者",dataIndex:"message.senderName",render:function(e,t,s){var r={fontWeight:900,color:"black",fontSize:".875rem"};return t.hasRead&&(r={fontWeight:400,color:"#999",fontSize:".875rem"}),y.default.createElement("div",null,y.default.createElement("span",{style:r},e))}},{title:"类别",dataIndex:"message.messageType.name",render:function(e,t,s){return y.default.createElement("span",null,e)}},{title:"时间",dataIndex:"message.createdTime",render:function(e){return(0,x.toLocaleString)(e)},defaultSortOrder:"descend",sorter:!0}],f=this.state,m=f.selectedRowKeys,A=f.selectedRows;return y.default.createElement(r.default,{spinning:this.props.loading,size:"large"},y.default.createElement("h2",null,"消息中心"),y.default.createElement("hr",null),y.default.createElement(g.default,{defaultActiveKey:"0",activeKey:this.state.activeKey,onChange:this.tabOnChange,tabPosition:"top"},this.props.appList.map(function(r,c){return y.default.createElement(E,{tab:r.appName,key:c+""},y.default.createElement(i.default,{style:{marginBottom:8}},y.default.createElement(d.default,{value:e.props.title,style:{width:150,marginRight:8},placeholder:"请输入标题",onChange:function(t){e.props.update({name:"title",value:t.target.value}),e.props.getMessageList({userId:e.props.userId,appId:e.props.app,enterpriseId:e.props.enterprises[e.props.currentEnterprise].id,title:t.target.value,selectMessageTypes:e.props.selectMessageTypes,ifRead:e.props.ifRead,importance:e.props.importance,ifHide:!e.props.ifHide,orderTime:e.props.orderTime,page:e.props.page,size:e.props.size})}}),c>0&&y.default.createElement(l.default,{mode:"multiple",value:e.props.selectMessageTypes,style:{width:150,marginRight:8},placeholder:"请选择类型",onChange:function(t){e.props.update({name:"selectMessageTypes",value:t}),e.props.getMessageList({userId:e.props.userId,appId:e.props.app,enterpriseId:e.props.enterprises[e.props.currentEnterprise].id,title:e.props.title,selectMessageTypes:t,ifRead:e.props.ifRead,importance:e.props.importance,ifHide:!e.props.ifHide,orderTime:e.props.orderTime,page:e.props.page,size:e.props.size})}},e.props.messageTypeList.map(function(e){return y.default.createElement(l.default.Option,{key:e.id,value:e.id},e.name)})),y.default.createElement(l.default,{value:e.props.ifRead,style:{width:150,marginRight:8},placeholder:"请选择是否已读",onChange:function(t){e.props.update({name:"ifRead",value:t}),e.props.getMessageList({userId:e.props.userId,appId:e.props.app,enterpriseId:e.props.enterprises[e.props.currentEnterprise].id,title:e.props.title,selectMessageTypes:e.props.selectMessageTypes,ifRead:t,importance:e.props.importance,ifHide:!e.props.ifHide,orderTime:e.props.orderTime,page:e.props.page,size:e.props.size})}},y.default.createElement(l.default.Option,{key:"4",value:"true,false"},"全部"),y.default.createElement(l.default.Option,{key:"5",value:"true"},"已读"),y.default.createElement(l.default.Option,{key:"6",value:"false"},"未读")),y.default.createElement(l.default,{value:e.props.importance,style:{width:150},placeholder:"请选择是否重要",onChange:function(t){e.props.update({name:"importance",value:t}),e.props.getMessageList({userId:e.props.userId,appId:e.props.app,enterpriseId:e.props.enterprises[e.props.currentEnterprise].id,title:e.props.title,selectMessageTypes:e.props.selectMessageTypes,ifRead:e.props.ifRead,importance:t,ifHide:!e.props.ifHide,orderTime:e.props.orderTime,page:e.props.page,size:e.props.size})}},y.default.createElement(l.default.Option,{key:"0",value:"importance,normal"},"全部"),y.default.createElement(l.default.Option,{key:"1",value:"importance"},"重要"),y.default.createElement(l.default.Option,{key:"2",value:"normal"},"不重要"))),y.default.createElement(i.default,null,y.default.createElement(o.default,{rowSelection:{selectedRowKeys:m,selectedRows:A,type:"checkbox",onChange:e.selectedMessages},rowKey:function(e){return e.id},columns:s,dataSource:e.props.messageList,showHeader:!0,pagination:t,onChange:e.handleTableChange})),y.default.createElement(i.default,null,y.default.createElement(p.default,{style:{marginBottom:8}},y.default.createElement(a.default,{checked:e.props.ifHide,onChange:function(t){e.props.update({name:"ifHide",value:t.target.checked}),e.props.getMessageList({userId:e.props.userId,appId:e.props.app,enterpriseId:e.props.enterprises[e.props.currentEnterprise].id,title:e.props.title,selectMessageTypes:e.props.selectMessageTypes,ifRead:e.props.ifRead,importance:e.props.importance,ifHide:!t.target.checked,orderTime:e.props.orderTime,page:e.props.page,size:e.props.size})}},"隐藏")),y.default.createElement(p.default,null,y.default.createElement(n.default,{style:{marginRight:4},type:"danger",icon:"delete",disabled:0===e.state.selectedRowKeys.length,onClick:e.onDeleteClick},"隐藏"),y.default.createElement(n.default,{icon:"read",type:"primary",disabled:0===e.state.selectedRowKeys.length,onClick:e.onMarkReadClick},"标记已读"))))})))}}]),t}();t.default=(0,C.connect)(function(e){return m({},e.receiveMessage,{enterprises:e.userData.enterprises,currentEnterprise:e.userData.currentEnterprise,userId:e.authentication.userId,roles:e.userData.roles,currentRole:e.userData.currentRole})},function(e,t){return{dispatch:e,update:function(t){e((0,I.update)(t))},getAppList:function(t,s,r){e((0,I.getAppList)(t,s,r))},getMessageTypeList:function(t){e((0,I.getMessageTypeList)(t))},getMessageList:function(t){e((0,I.getMessageList)(t))},onToDetail:function(e){t.history.push(e)}}})(D)}});