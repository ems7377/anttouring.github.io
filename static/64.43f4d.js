webpackJsonp([64],{PGAL:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=m(r("trpn")),s=m(r("yF52")),a=m(r("0b0c")),o=m(r("G3dI")),i=m(r("NJOH")),l=m(r("IidI")),p=m(r("1cZb")),u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();r("Op6J"),r("tNTX"),r("kxBb"),r("/Hhv"),r("mKHw"),r("1uA9"),r("YaoS");var c=r("U7vG"),d=m(c),f=r("4n+p"),h=m(r("mtWM"));function m(e){return e&&e.__esModule?e:{default:e}}var g=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.getAppList=function(e){(0,h.default)("/api-user/getApps/"+e).then(function(e){return e.data}).then(function(e){r.setState({appList:e}),r.setState({app:e.length>0?e[0].appId:""})}).catch(function(e){p.default.error("暂无应用列表"),r.setState({loading:!1})})},r.getRoleList=function(e){(0,h.default)("/api-user/enterprises/"+e+"/roles?page=0&size=1000").then(function(e){return e.data}).then(function(e){(r.setState({roleList:e.content}),r.props.roles[r.props.currentRole])?e.content.find(function(e){return e.id===r.props.roles[r.props.currentRole].id})===undefined?r.setState({role:e.content>0?e.content[0].id:""}):r.setState({role:r.props.roles[r.props.currentRole].id}):e.content.length>0&&r.setState({role:e.content[0].id})}).catch(function(e){p.default.error("暂无角色列表"),r.setState({loading:!1})})},r.selectedRoles=function(e,t){r.setState({selectedRowKeys:e,selectedRows:t})},r.getRoleWithRoles=function(e,t){(0,h.default)("/api-message/message-role-list?app="+e+"&role="+t).then(function(e){return e.data}).then(function(e){r.setState({selectedRowKeys:e,loading:!1})}).catch(function(e){p.default.error("暂无角色列表"),r.setState({loading:!1})})},r.onSubmitClick=function(){r.setState({loading:!0}),(0,h.default)({method:"patch",url:"/api-message/message-role-list",contentType:"application/json",withCredentials:!0,data:{senderRoleId:r.state.role,appId:r.state.app,createUser:r.props.userId,roleIds:r.state.selectedRowKeys}}).then(function(e){r.setState({loading:!1}),200===e.status?p.default.success("保存成功"):p.default.error("保存失败")}).catch(function(e){p.default.error("保存失败"),r.setState({loading:!1})})},r.state={appList:[],app:"",role:"",roleList:[],selectedRowKeys:[],selectedRows:[],loading:!1,total:0,size:10,page:0},r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,c.Component),u(t,[{key:"componentDidMount",value:function(){this.props.enterprises[this.props.currentEnterprise]&&(this.getRoleList(this.props.enterprises[this.props.currentEnterprise].id),this.getAppList(this.props.enterprises[this.props.currentEnterprise].id))}},{key:"componentDidUpdate",value:function(e,t){!this.props.enterprises[this.props.currentEnterprise]||this.props.currentEnterprise===e.currentEnterprise&&this.props.enterprises===e.enterprises||(this.getRoleList(this.props.enterprises[this.props.currentEnterprise].id),this.getAppList(this.props.enterprises[this.props.currentEnterprise].id)),this.state.role===t.role&&this.state.app===t.app||this.state.app&&this.state.role&&(this.setState({loading:!0}),this.getRoleWithRoles(this.state.app,this.state.role))}},{key:"render",value:function(){var e=this;if(this.props.roles[this.props.currentRole]&&this.props.enterprises[this.props.currentEnterprise]){var t=this.state,r=t.selectedRowKeys,p=t.selectedRows;return d.default.createElement(n.default,{spinning:this.state.loading,size:"large"},d.default.createElement("h2",null,"配置消息发送角色"),d.default.createElement("hr",null),d.default.createElement(l.default,{disabled:!this.state.app||!this.state.role,type:"primary",style:{marginBottom:8},onClick:this.onSubmitClick},"保存"),d.default.createElement(a.default,null,d.default.createElement(o.default,null,d.default.createElement("span",{style:{marginRight:8}},"应用："),d.default.createElement(i.default,{style:{width:"60%",marginBottom:8},value:this.state.app,onChange:function(t){e.setState({app:t})}},this.state.appList.map(function(e){return d.default.createElement(i.default.Option,{key:e.appId,value:e.appId},e.appName)}))),d.default.createElement(o.default,null,d.default.createElement("span",{style:{marginRight:8}},"角色："),d.default.createElement(i.default,{style:{width:"60%",marginBottom:8},value:this.state.role,defaultValue:this.props.roles[this.props.currentRole].id,onChange:function(t){e.setState({role:t})}},this.state.roleList.map(function(e){return d.default.createElement(i.default.Option,{key:e.id,value:e.id},e.name)})))),d.default.createElement(s.default,{rowKey:function(e){return e.id},rowSelection:{selectedRowKeys:r,selectedRows:p,type:"checkbox",onChange:this.selectedRoles},columns:[{title:"名称",dataIndex:"name"},{title:"描述",dataIndex:"description"}],dataSource:this.state.roleList,showHeader:!0,bordered:!0,pagination:!1}))}return null}}]),t}();t.default=(0,f.connect)(function(e){return{userId:e.authentication.userId,roles:e.userData.roles,currentRole:e.userData.currentRole,enterprises:e.userData.enterprises,currentEnterprise:e.userData.currentEnterprise}},function(e){return{dispatch:e}})(g)}});