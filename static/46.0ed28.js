webpackJsonp([46],{"5Lcu":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mapDispatchToProps=t.mapStateToProps=undefined;var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),s=c(a("U7vG")),r=a("4n+p"),o=c(a("CvFA")),i=a("QCXU"),u=a("Zfgq");function c(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default.Component),n(t,[{key:"componentDidMount",value:function(){this.props.getQuotaSummary(this.props.currentEnterprise)}},{key:"render",value:function(){if(""!==this.props.currentEnterprise)return s.default.createElement(o.default,this.props);u.browserHistory.push("/exception/404")}}]),t}(),p=t.mapStateToProps=function(e){try{return{quotaList:e.increaseQuota.quotaList,months:e.increaseQuota.months,databaseSize:e.increaseQuota.databaseSize,currentEnterprise:e.userData.enterprises[e.userData.currentEnterprise].id,cpu:e.increaseQuota.cpu,memory:e.increaseQuota.memory,disk:e.increaseQuota.disk}}catch(e){return{currentEnterprise:""}}},d=t.mapDispatchToProps=function(e){return{dispatch:e,getQuotaSummary:function(t){e((0,i.getQuotaSummary)(t))},update:function(t){e((0,i.updateIncreaseQuotaData)(t))}}};t.default=(0,r.connect)(p,d)(l)},CvFA:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=S(a("0b0c")),s=S(a("G3dI")),r=S(a("aCj6")),o=S(a("vgHw")),i=S(a("vaID")),u=S(a("IidI")),c=S(a("PVZZ")),l=S(a("NJOH")),p=S(a("1cZb")),d=S(a("uuhB")),f=S(a("37+n")),m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},h=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();a("kxBb"),a("/Hhv"),a("kJGR"),a("ZJow"),a("nclB"),a("1uA9"),a("NZBz"),a("mKHw"),a("YaoS"),a("TZP0"),a("8QNH");var b=S(a("U7vG")),_=a("Pq8k"),y=S(a("mtWM")),g=a("y3Xk");function S(e){return e&&e.__esModule?e:{default:e}}var v=f.default.Item,E=d.default.TextArea,I=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.calculateAmount=a.calculateAmount.bind(a),a.getDatabasePrice=a.getDatabasePrice.bind(a),a.showTermsModal=a.showTermsModal.bind(a),a.handleCancel=a.handleCancel.bind(a),a.getLeaseTermDiscount=a.getLeaseTermDiscount.bind(a),a.checkboxChange=a.checkboxChange.bind(a),a.inLeaseTerm=a.inLeaseTerm.bind(a),a.getOrgInfo=a.getOrgInfo.bind(a),a.checkDatabaseSize=a.checkDatabaseSize.bind(a),a.getMonthByDateMinus=a.getMonthByDateMinus.bind(a),a.postIncreaseQuota=a.postIncreaseQuota.bind(a),a.getAccountBalance=a.getAccountBalance.bind(a),a.showBalanceModal=a.showBalanceModal.bind(a),a.getNamespace=a.showBalanceModal.bind(a),a.postNamespace=a.showBalanceModal.bind(a),a.state={quotaPlan:"",description:"",price:"0",memory:"",databasePrice:"0",termsModalVisible:!1,discount:"1",checkboxStatus:!1,inputStatus:!0,quotaId:"",quotaPrice:"",databaseSpace:"",databasePlaceholder:"",databasePriceBefore:"",remainDays:"",totalDays:"",monthsBefore:"",discountBefore:"",runtimeStart:"",runtimeEnd:"",quotaPlanId:"",requiredStatus:!0,accountId:"",balance:"",balanceModalVisible:!1},a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,b.default.Component),h(t,[{key:"componentDidMount",value:function(){this.props.form.resetFields(),this.inLeaseTerm(),this.getOrgInfo(),this.getAccountBalance()}},{key:"getDatabasePrice",value:function(e){var t=this;(0,y.default)({method:"GET",url:"/api-tenant/databasePrices?max="+e,contentType:"application/json"}).then(function(e){200===e.status&&t.setState({databasePrice:e.data[0].fees})})}},{key:"getLeaseTermDiscount",value:function(e){var t=this;(0,y.default)({method:"GET",url:"/api-tenant/leaseTerms?max="+e,contentType:"application/json"}).then(function(e){200===e.status&&t.setState({discount:e.data[0].discount})})}},{key:"getOrgInfo",value:function(){var e=this;(0,y.default)({method:"GET",url:"/api-tenant/organization?enterprise-code="+this.props.currentEnterprise,contentType:"application/json"}).then(function(t){200===t.status&&e.setState({quotaId:t.data.quotaDefinitionId,databaseSpace:t.data.databaseSpace,runtimeStart:(0,g.toLocaleString)(t.data.runtimeStart,!1),runtimeEnd:(0,g.toLocaleString)(t.data.runtimeEnd,!1)}),(0,y.default)({method:"GET",url:"/api-tenant/orgQuotaWithCredential?quota-id="+e.state.quotaId,contentType:"application/json"}).then(function(t){200===t.status&&e.setState({quotaPrice:t.data.price})}),(0,y.default)({method:"GET",url:"/api-tenant/databasePrices?max="+e.state.databaseSpace,contentType:"application/json"}).then(function(t){200===t.status&&e.setState({databasePriceBefore:t.data[0].fees})}),e.setState({monthsBefore:e.getMonthByDateMinus(e.state.runtimeStart,e.state.runtimeEnd)}),(0,y.default)({method:"GET",url:"/api-tenant/leaseTerms?max="+e.state.monthsBefore,contentType:"application/json"}).then(function(t){200===t.status&&e.setState({discountBefore:t.data[0].discount})})})}},{key:"showTermsModal",value:function(){this.setState({termsModalVisible:!0})}},{key:"handleCancel",value:function(){this.setState({termsModalVisible:!1,balanceModalVisible:!1})}},{key:"showBalanceModal",value:function(){this.setState({balanceModalVisible:!0})}},{key:"checkboxChange",value:function(e){this.setState({checkboxStatus:e.target.checked})}},{key:"getAccountBalance",value:function(){var e=this;(0,y.default)({method:"GET",url:"/api-user/enterprise?id="+this.props.currentEnterprise,contentType:"application/json"}).then(function(t){200===t.status&&e.setState({accountId:t.data.account}),(0,y.default)({method:"GET",url:"/api-account/account?id="+e.state.accountId,contentType:"application/json"}).then(function(t){200===t.status&&e.setState({balance:t.data.balance})})})}},{key:"calculateAmount",value:function(){if(!1===this.state.inputStatus){var e=(Number(this.state.monthsBefore)*Number(this.state.remainDays)/Number(this.state.totalDays)*(Number(this.state.price)+Number(this.props.databaseSize)*Number(this.state.databasePrice)-(Number(this.state.quotaPrice)+Number(this.state.databaseSpace)*Number(this.state.databasePriceBefore)))*Number(this.state.discountBefore)).toString();return e<0?"0":Math.round(e)}return(Number(this.props.months)*(Number(this.state.price)+Number(this.props.databaseSize)*Number(this.state.databasePrice))*Number(this.state.discount)).toString()}},{key:"inLeaseTerm",value:function(){var e=this;(0,y.default)({method:"GET",url:"/api-tenant/org/in-leaseterm?enterprise-code="+this.props.currentEnterprise,contentType:"application/json"}).then(function(t){200===t.status&&("0"===t.data[0]?e.setState({inputStatus:!0,databasePlaceholder:"数据库存储空间必须大于5GB",requiredStatus:!0}):e.setState({inputStatus:!1,databasePlaceholder:" 请输入数据库存储空间",remainDays:t.data[0],totalDays:t.data[1],requiredStatus:!1}))})}},{key:"checkDatabaseSize",value:function(e,t,a){!1===this.state.inputStatus&&(parseInt(t)<parseInt(this.state.databaseSpace)?a("必须大于现有的数据库存储空间大小"):a())}},{key:"getMonthByDateMinus",value:function(e,t){return e=""!==e&&null!==e?e.split("-"):"",12*((t=""!==t&&null!==t?t.split("-"):"")[0]-e[0])+(t[1]-e[1])}},{key:"postIncreaseQuota",value:function(e){var t=this;e.preventDefault(),this.props.form.validateFields(function(e,a){e||(!1===t.state.inputStatus&&t.calculateAmount()<=t.state.balance?(0,y.default)({method:"post",url:"/api-account/useMoney",contentType:"application/json",withCredentials:!0,data:{accountId:t.state.accountId,money:"-"+t.calculateAmount(),content:"申请资源",userId:t.props.currentEnterprise,category:"资源"}}).then(function(e){200===e.status&&(0,y.default)({method:"post",url:"/api-tenant/org/increase-quota",contentType:"application/json",withCredentials:!0,data:{currentEnterprise:t.props.currentEnterprise,quotaPlanId:t.state.quotaPlanId,databaseSize:t.props.databaseSize}}).then(function(e){200===e.status?p.default.success("申请资源成功",5):p.default.error("申请资源失败",5)})}):!0===t.state.inputStatus&&t.calculateAmount()<=t.state.balance?(0,y.default)({method:"post",url:"/api-account/useMoney",contentType:"application/json",withCredentials:!0,data:{accountId:t.state.accountId,money:"-"+t.calculateAmount(),content:"申请新资源",userId:t.props.currentEnterprise,category:"资源"}}).then(function(e){200===e.status&&(0,y.default)({method:"post",url:"/api-tenant/org/new-increase-quota",contentType:"application/json",withCredentials:!0,data:{currentEnterprise:t.props.currentEnterprise,months:t.props.months,quotaPlanId:t.state.quotaPlanId,databaseSize:t.props.databaseSize}}).then(function(e){200===e.status?p.default.success("申请新资源成功",5):p.default.error("申请新资源失败",5)})}):t.showBalanceModal())})}},{key:"getNamespace",value:function(){var e=this;(0,y.default)({method:"GET",url:"/api-tenant/namespace/getNamespace/"+this.props.currentEnterprise,contentType:"application/json"}).then(function(t){200===t.status&&e.setState({namespace:t.data[0].namespace})})}},{key:"postNamespace",value:function(){var e=this,t=new Headers;t.append("enctype","multipart/form-data");var a=new FormData;a.append("enterpriseId",this.props.currentEnterpirse),a.append("cpu",this.props.cpu),a.append("memory",this.props.memory),a.append("disk",this.props.disk),fetch("/api-tenant/namespace/changeNamespace/",{headers:t,method:"POST",body:a,credentials:"include"}).then(function(t){200===t.status?(e.setState({databaseModalVisible:!1}),e.getDatabase(),p.default.success("创建成功")):(e.setState({databaseModalVisible:!1}),p.default.error("创建失败"))})}},{key:"render",value:function(){var e=this,t=this.props.form.getFieldDecorator,a={labelCol:{xs:{span:24},sm:{span:24},md:{span:24},lg:{span:6}},wrapperCol:{xs:{span:24},sm:{span:24},md:{span:24},lg:{span:12}}},p={wrapperCol:{xs:{span:24,offset:0},sm:{span:24,offset:0},md:{span:24,offset:0},lg:{span:18,offset:6}}};return b.default.createElement("div",{style:{padding:"30px"}},b.default.createElement(n.default,null,b.default.createElement(s.default,{span:18,offset:3},b.default.createElement(r.default,{title:this.props.intl.formatMessage({id:"scenes_Space_IncreaseQuota_IncreaseQuotaComponent_title"})},b.default.createElement(f.default,null,b.default.createElement(v,m({},a,{label:this.props.intl.formatMessage({id:"scenes_Space_IncreaseQuota_IncreaseQuotaComponent_months"})}),t("months",{initialValue:this.props.months,getValueFromEvent:function(e){return e.target.value},rules:[{required:this.state.requiredStatus,message:this.props.intl.formatMessage({id:"scenes_Space_IncreaseQuota_IncreaseQuotaComponent_monthRequired"})},{pattern:/^[0-9]+$/,message:this.props.intl.formatMessage({id:"scenes_Space_IncreaseQuota_IncreaseQuotaComponent_monthCheck"})}]})(b.default.createElement(d.default,{addonAfter:this.props.intl.formatMessage({id:"scenes_Space_IncreaseQuota_IncreaseQuotaComponent_monthAddon"}),placeholder:this.props.intl.formatMessage({id:"scenes_Space_IncreaseQuota_IncreaseQuotaComponent_monthPlaceholder"}),disabled:!1===this.state.inputStatus,onChange:function(t){e.props.update({name:"months",value:t.target.value})}}))),b.default.createElement(v,m({},a,{label:"租用时长折扣信息"}),b.default.createElement(E,{rows:4,disabled:!0,value:"0-3个月，无折扣；\n3-12个月，9折；\n12-24个月，8折；\n24个月以上，7折。"})),b.default.createElement(v,m({},a,{label:this.props.intl.formatMessage({id:"scenes_Space_IncreaseQuota_IncreaseQuotaComponent_quotaPlan"})}),t("quotaPlan",{getValueFromEvent:function(e){return e},rules:[{required:!0,message:this.props.intl.formatMessage({id:"scenes_Space_IncreaseQuota_IncreaseQuotaComponent_quotaPlanRequired"})}]})(b.default.createElement(l.default,{placeholder:this.props.intl.formatMessage({id:"scenes_Space_IncreaseQuota_IncreaseQuotaComponent_quotaPlanPlaceholder"}),onChange:function(t){e.setState({quotaPlan:t,description:e.props.quotaList.filter(function(e){return e.name===t})[0].description,price:e.props.quotaList.filter(function(e){return e.name===t})[0].price,memory:e.props.quotaList.filter(function(e){return e.name===t})[0].memory,quotaPlanId:e.props.quotaList.filter(function(e){return e.name===t})[0].id})}},this.props.quotaList.map(function(t){return b.default.createElement(l.default.Option,{value:t.name,disabled:t.price<e.state.quotaPrice},t.name)})))),b.default.createElement(v,m({},a,{label:this.props.intl.formatMessage({id:"scenes_Space_IncreaseQuota_IncreaseQuotaComponent_memSize"})}),b.default.createElement(d.default,{addonAfter:"MB",placeholder:this.props.intl.formatMessage({id:"scenes_Space_IncreaseQuota_IncreaseQuotaComponent_memSizePlaceholder"}),disabled:!0,value:this.state.memory})),b.default.createElement(v,m({},a,{label:this.props.intl.formatMessage({id:"scenes_Space_IncreaseQuota_IncreaseQuotaComponent_price"})}),b.default.createElement(E,{rows:3,disabled:!0,placeholder:this.props.intl.formatMessage({id:"scenes_Space_IncreaseQuota_IncreaseQuotaComponent_pricePlaceholder"}),value:this.props.intl.formatMessage({id:"scenes_Space_IncreaseQuota_IncreaseQuotaComponent_priceValueBefore"})+this.state.price.toString()+this.props.intl.formatMessage({id:"scenes_Space_IncreaseQuota_IncreaseQuotaComponent_priceValueAfter"})})),b.default.createElement(v,m({},a,{label:this.props.intl.formatMessage({id:"scenes_Space_IncreaseQuota_IncreaseQuotaComponent_description"})}),b.default.createElement(E,{rows:8,disabled:!0,placeholder:this.props.intl.formatMessage({id:"scenes_Space_IncreaseQuota_IncreaseQuotaComponent_descriptionPlaceholder"}),value:this.state.description})),b.default.createElement(v,m({},a,{label:"数据库存储空间"}),t("databaseSize",{getValueFromEvent:function(e){return e.target.value},rules:[{required:!0,message:"请输入数据库存储空间!"},{pattern:/^(([5-9]?)|[0-9]{2,}?)$/,message:"数据库存储空间必须是大于5的整数"},{validator:this.checkDatabaseSize}]})(b.default.createElement(d.default,{placeholder:this.state.databasePlaceholder,addonAfter:"GB",onChange:function(t){e.props.update({name:"databaseSize",value:t.target.value}),""!==t.target.value?e.getDatabasePrice(t.target.value):e.setState({databasePrice:"0"})}}))),b.default.createElement(v,m({},a,{label:"数据库存储空间资费"}),b.default.createElement(E,{rows:3,disabled:!0,placeholder:"这里将根据数据库存储空间显示价格信息",value:"您当前选择的数据库存储空间资费为"+this.state.databasePrice+"元/GB"})),b.default.createElement(v,m({},a,{label:this.props.intl.formatMessage({id:"scenes_Space_IncreaseQuota_IncreaseQuotaComponent_amount"})}),b.default.createElement(d.default,{placeholder:this.props.intl.formatMessage({id:"scenes_Space_IncreaseQuota_IncreaseQuotaComponent_amountPlaceholder"}),value:this.calculateAmount()+this.props.intl.formatMessage({id:"scenes_Space_IncreaseQuota_IncreaseQuotaComponent_amountValueAfter"}),disabled:!0})),b.default.createElement(v,p,b.default.createElement(c.default,{onChange:this.checkboxChange},"我已阅读并同意",b.default.createElement("a",{onClick:this.showTermsModal},"相关服务条款")),b.default.createElement(i.default,{title:"服务条款",visible:this.state.termsModalVisible,onCancel:this.handleCancel,footer:[b.default.createElement(u.default,{type:"primary",onClick:this.handleCancel},"确定")]},b.default.createElement(E,{rows:10,value:"一、合同适用说明 1.本合同适用于首次购买XX产品及购买XX服务产品的用户。 2.甲乙双方签订本合同，表明甲方接受乙方所提供的标准服务；否则，视为甲方主动放弃乙方所提供的服务。\r 二、服务内容 1.乙方提供的服务内容：1）品标准培训：乙方负责承担甲方所购买产品的标准培训；标准培训为指导建账和为期四个工作小时的业务指导。2）热线支持：指乙方服务人员通过电话向用户提供技术问题解答的过程。\r 3）在线服务支持：指乙方通过在线支持系统接收、解答用户问题，并在网上发布相关技术解决问题的过程。4）现场维护：指乙方派遣技术人员到用户现场处理问题的过程。5）远程维护：指乙方通过《XX维护软件》解答用户问题的服务过程。\r 6）用户俱乐部活动：甲方可以参加XX用户俱乐部的活动。7）用户刊物：甲方可以不定期的获取乙方提供的用户刊物，用户刊物包括出版的刊物和电子刊物。2、乙方的服务承诺：\r 1）乙方接到甲方通过电话、信函传真、电子邮件、网上提交等方式提出关于XX软件的服务请求后，在两个有效工作日内给予响应并提供服务。2）乙方提供给甲方的服务，必须按照合同规定的服务内容进行。\r 三、甲方责任：1.甲方应确保有专人对xx软件的使用和管理负责。2.甲方应建立相关制度，以确保xx软件运行环境（包括计算机、打印机及相关硬件设备）3.甲方定期做好系统数据备份，并对备份数据进行妥善保管。\r 4.甲方在应用过程中发现软件出现异常，应及时与甲方取得联系，并记录当前故障现象，便于乙方作出诊断。5.甲方在乙方服务人员服务完成后，配合检查软件系统运行是否正常。\r 四、违约处理 1.乙方违争取处理：1）甲方有权对乙方不履行合同条款的行为向XX公司服务管理部门投诉；XX公司服务投诉电话：XXXXXXXX 2）乙方违反以上服务承诺时，在接到甲方投诉后，维护部门立即采取补救措施，并给用户满意答复。\r 3）乙方在确认违反了服务承诺，并给甲方造成实际损失，应该给甲方以适当的经济补偿。2.甲方违约处理 1）甲方没有按照合同要求履行甲方应承担的责任，甲方应该承担由此带来的相关后果。\r 2）因甲方法人员进行非法操作、感染病毒、配件出现故障导致的数据混乱、丢失等问题，甲方请求乙方提供服务的，乙方可以按照软件服务费的100%，加收服务费。\r 3.乙方免责条款 1）乙方不承担因甲方人员进行非法操作、感染病毒、硬件出现故障导致的数据混乱乱、丢失责任。2）乙方有权拒绝甲方提出的合同规定之外的服务请求。\r 五、合同有效期和效用性 1.本合同须双方签字并加盖公章或合同章生效；本合同一式两份，双方各执一份，具有同等法律效力\r 2.本合同的有效性不因双方代表的职务变换、工作变更、工作调动等情况而受任何影响；本合同的有效性不因双方法人的变更而受任何影响；本合同的有效性不因双方单位名称的改变而受任何影响。\r 六、收费办法和合同期限 1.购买XX版、XX版）大写：_______________. 2.合同有效期限为一年，自___年__月__日至___年__月__日止，合同期满自动中止。\r 3.合同期满后，双方协商，乙方可以继续为甲方提供用友软件运行维护服务；但双方必须重新签署新的服务合同。\r 七、争议处理 1.甲乙双方如对协议条款规定的理解有异议，或者对与协议有关的事项发生争议，双方应本着友好合作的精神进行协商。\r 2.协商不能解决的，依照《中华人民共和国合同法》，任何一方可向乙方所在地的人民法院起诉。\r 八、其他 1.本合同未尽事宜，由甲乙双方协商后产生书面文件，作为本合同的补充条款，具备与本合同同等法律效力。\r 2.对本合同内容的任何修改和变更需要用书面形式，并经双方确认后生效。\r 3.本合同为双方唯一的正式协议，其他任何方案、口头说明及与本项目有关的信函、传真、邮件等，均以本合同为准。"}))),b.default.createElement(v,p,b.default.createElement(u.default,{type:"primary",disabled:!1===this.state.checkboxStatus,onClick:this.postIncreaseQuota},"立即申请"),b.default.createElement(i.default,{title:b.default.createElement("span",null,b.default.createElement(o.default,{type:"warning",style:{color:"red",marginRight:"4px"}}),"警告"),visible:this.state.balanceModalVisible,onCancel:this.handleCancel,footer:[b.default.createElement(u.default,{onClick:this.handleCancel},"取消"),b.default.createElement(u.default,{type:"primary",onClick:this.handleCancel},"立即充值")]},b.default.createElement("p",null,"余额不足，请立即充值"))))))))}}]),t}();I=f.default.create()(I),t.default=(0,_.injectIntl)(I)}});